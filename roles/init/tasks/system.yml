- name: "Checking {{ bind_interface }}"
  fail:
    msg: "interface {{ bind_interface }} has no IP address"
  when: hostvars[inventory_hostname]['ansible_' + bind_interface]['ipv4']['address'] == ''

- name: Setup sysctl
  sysctl:
    name: '{{ item.name }}'
    value: '{{ item.value }}'
    state: present
  with_items:
    - name: vm.max_map_count
      value: 262144
    - name: vm.swappiness
      value: 1
    - name: fs.file-max
      value: 65536
    - name: net.ipv4.ip_forward
      value: 1
    - name: net.core.somaxconn
      value: 512
    - name: vm.overcommit_memory
      value: 1

- name: Disable swap
  command: swapoff -a
  when: "'elasticsearch' in group_names"
  changed_when: false

- name: "Setup timezone to {{ timezone }}"
  timezone:
    name: '{{ timezone }}'
