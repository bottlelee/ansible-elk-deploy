- name: Testing filebeat config
  command: 'filebeat test {{ item }}'
  with_items:
    - output
    - config
  listen: "Restart filebeat"

- name: Restart filebeat service
  service:
    name: filebeat
    state: restarted
    enabled: yes
  listen: "Restart filebeat"

- name: Testing metricbeat config
  command: 'metricbeat test {{ item }}'
  with_items:
    - modules
    - output
    - config
  listen: "Restart metricbeat"

- name: Restart metricbeat service
  service:
    name: metricbeat
    state: restarted
    enabled: yes
  listen: "Restart metricbeat"

- name: Testing packetbeat config
  command: 'packetbeat test {{ item }}'
  with_items:
    - output
    - config
  listen: "Restart packetbeat"

- name: Restart packetbeat service
  service:
    name: packetbeat
    state: restarted
    enabled: yes
  listen: "Restart packetbeat"
